<!doctype html>
<html>
  <head>
    <title>Biped</title>
    <style>
      body { margin: 0; font-family: Arial, sans serif; background: #f6f6f6; }
      .wrap { padding: 18px; max-width: 900px; margin: 0 auto; }
      .card { background: white; border-radius: 14px; padding: 16px; box-shadow: 0 8px 22px rgba(0,0,0,0.12); }
      h1 { margin: 0 0 12px 0; font-size: 18px; }
      .row { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
      .field { display: flex; flex-direction: column; gap: 6px; }
      label { font-size: 12px; opacity: 0.75; }
      input { padding: 10px 12px; border-radius: 10px; border: 1px solid rgba(0,0,0,0.18); min-width: 220px; }
      button { padding: 10px 12px; border: 0; border-radius: 12px; cursor: pointer; background: rgba(0,0,0,0.82); color: white; font-size: 13px; }
      button.secondary { background: rgba(0,0,0,0.12); color: black; }
      .note { margin-top: 10px; font-size: 12px; opacity: 0.75; line-height: 1.4; }
      .log { margin-top: 12px; font-family: Consolas, monospace; font-size: 12px; white-space: pre-wrap; background: rgba(0,0,0,0.06); padding: 10px; border-radius: 10px; }
      .pill { display: inline-block; padding: 4px 10px; border-radius: 999px; background: rgba(0,0,0,0.08); font-size: 12px; }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="card">
        <h1>Biped</h1>
        <div class="row" style="margin-bottom:12px;">
          <div class="pill" id="selName">Selected: </div>
        </div>

        <div class="row">
          <div class="field">
            <label>Shoulder id</label>
            <input id="shoulderId" value="Shoulder_R" />
          </div>
          <div class="field">
            <label>Elbow id</label>
            <input id="elbowId" value="Elbow_R" />
          </div>
        </div>

        <div class="row" style="margin-top:12px;">
          <button id="btnArrange">Arrange</button>
          <button class="secondary" id="btnRefresh">Refresh selection</button>
          <button class="secondary" id="btnClearLog">Clear log</button>
        </div>

        <div class="note">
          Arrange moves Shoulder and Elbow inside the selected clip. Close this tool to show the pose panel in Wick Editor.
        </div>

        <div class="log" id="log"></div>
      </div>
    </div>

    <script>
      function s(v) { return (v === null || v === undefined) ? "" : String(v); }

      function logLine(t) {
        var el = document.getElementById("log");
        el.textContent = (el.textContent ? el.textContent + "\n" : "") + t;
      }

      function getBridge() {
        try { if (window.LukeToolsBridge) return window.LukeToolsBridge; } catch (e1) {}
        try { if (parent && parent.LukeToolsBridge) return parent.LukeToolsBridge; } catch (e2) {}
        return null;
      }

      function refreshSelection() {
        var bridge = getBridge();
        if (!bridge) {
          document.getElementById("selName").textContent = "Selected: bridge missing";
          return;
        }
        try {
          var info = bridge.captureSelectionNow();
          var nm = (info && info.name) ? info.name : bridge.getSelectedClipName();
          document.getElementById("selName").textContent = "Selected: " + s(nm);
        } catch (e) {
          document.getElementById("selName").textContent = "Selected: error";
          logLine("Selection error " + s(e));
        }
      }

      function arrange() {
        var bridge = getBridge();
        if (!bridge) { logLine("Bridge missing"); return; }

        var sh = s(document.getElementById("shoulderId").value).trim();
        var el = s(document.getElementById("elbowId").value).trim();

        refreshSelection();

        if (typeof bridge.arrangeArmRigOnSelection !== "function") {
          logLine("Arrange missing on bridge");
          return;
        }

        try {
          var res = bridge.arrangeArmRigOnSelection(sh, el);
          if (res && res.ok) {
            logLine("Arrange ok");
            if (res.shoulderLength !== undefined) logLine("Shoulder length " + s(res.shoulderLength));
          } else {
            logLine("Arrange failed " + s(res && res.error ? res.error : "unknown"));
          }
        } catch (e) {
          logLine("Arrange error " + s(e));
        }
      }

      document.getElementById("btnArrange").addEventListener("click", arrange);
      document.getElementById("btnRefresh").addEventListener("click", refreshSelection);
      document.getElementById("btnClearLog").addEventListener("click", function () {
        document.getElementById("log").textContent = "";
      });

      refreshSelection();
      logLine("Ready");
    </script>
  </body>
</html>
