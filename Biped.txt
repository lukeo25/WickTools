<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>NewBiped</title>
  <style>
    :root{
      --bg:#1b1f24;
      --panel:#252b31;
      --panel2:#1f242a;
      --stroke:#343c44;
      --stroke2:#2b323a;
      --text:#e7eef6;
      --muted:rgba(231,238,246,0.72);
      --muted2:rgba(231,238,246,0.55);
      --accent:#18c4a6;
      --danger:#ff5a52;
    }

    html, body{
      margin:0;
      padding:0;
      height:100%;
      background:var(--bg);
      color:var(--text);
      font-family: Arial, sans serif;
    }

    .wrap{
      height:100%;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding:16px;
      box-sizing:border-box;
    }

    .panel{
      width:560px;
      max-width:calc(100vw - 32px);
      background:var(--panel);
      border:1px solid var(--stroke);
      border-radius:6px;
      box-shadow:0 10px 30px rgba(0,0,0,0.45);
      overflow:hidden;
    }

    .hdr{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:10px 12px;
      background:var(--panel2);
      border-bottom:1px solid var(--stroke);
    }

    .hdrLeft{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }

    .brand{
      width:24px;
      height:24px;
      border-radius:4px;
      background:rgba(255,255,255,0.06);
      border:1px solid var(--stroke2);
      object-fit:contain;
      flex:0 0 auto;
    }

    .titleBlock{
      display:flex;
      flex-direction:column;
      min-width:0;
    }

    .title{
      font-size:14px;
      font-weight:700;
      letter-spacing:0.2px;
      line-height:1.1;
    }

    .sub{
      margin-top:2px;
      font-size:11px;
      color:var(--muted2);
      line-height:1.25;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width:420px;
    }

    .pill{
      font-size:11px;
      color:var(--muted);
      background:rgba(255,255,255,0.06);
      border:1px solid var(--stroke2);
      border-radius:4px;
      padding:5px 8px;
      white-space:nowrap;
    }

    .body{
      padding:12px;
    }

    .fieldRow{
      margin-top:0;
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }

    .field{
      background:rgba(0,0,0,0.12);
      border:1px solid var(--stroke2);
      border-radius:6px;
      padding:10px;
    }

    .field label{
      display:block;
      font-size:11px;
      color:var(--muted);
      margin-bottom:6px;
    }

    input[type="text"]{
      width:100%;
      box-sizing:border-box;
      padding:9px 10px;
      border-radius:5px;
      border:1px solid var(--stroke);
      background:rgba(0,0,0,0.20);
      color:var(--text);
      outline:none;
      font-size:12px;
    }

    input[type="text"]:focus{
      border-color:rgba(24,196,166,0.85);
      box-shadow:0 0 0 2px rgba(24,196,166,0.18);
    }

    .btnRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:12px;
    }

    button{
      appearance:none;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,0.06);
      color:var(--text);
      padding:9px 10px;
      border-radius:6px;
      cursor:pointer;
      font-size:12px;
      font-weight:700;
    }

    button.primary{
      background:rgba(24,196,166,0.18);
      border-color:rgba(24,196,166,0.50);
    }

    button:active{
      transform:translateY(1px);
    }

    .status{
      margin-top:12px;
      border:1px solid var(--stroke2);
      background:rgba(0,0,0,0.16);
      border-radius:6px;
      padding:10px;
      font-family:Consolas, monospace;
      font-size:12px;
      color:rgba(231,238,246,0.85);
      white-space:pre-wrap;
      line-height:1.4;
      min-height:42px;
    }

    .foot{
      margin-top:10px;
      display:flex;
      gap:10px;
      align-items:flex-start;
      justify-content:space-between;
    }

    .hint{
      font-size:11px;
      color:var(--muted2);
      line-height:1.45;
      flex:1 1 auto;
    }

    .hintCode{
      font-family:Consolas, monospace;
      font-size:11px;
      color:rgba(231,238,246,0.8);
      margin-top:6px;
      padding:6px 8px;
      border-radius:6px;
      border:1px solid var(--stroke2);
      background:rgba(0,0,0,0.14);
      display:inline-block;
    }

    .brandMini{
      display:flex;
      align-items:center;
      gap:8px;
      flex:0 0 auto;
      color:var(--muted2);
      font-size:11px;
      white-space:nowrap;
    }

    .brandMini img{
      width:16px;
      height:16px;
      border-radius:3px;
      border:1px solid var(--stroke2);
      background:rgba(255,255,255,0.06);
      object-fit:contain;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="panel">
      <div class="hdr">
        <div class="hdrLeft">
          <img class="brand" alt="Luke Tools" src="https://raw.githubusercontent.com/lukeo25/WickTools/main/LukeToolsBrand.png">
          <div class="titleBlock">
            <div class="title">Biped</div>
            <div class="sub">Select Arm_R then click Arrange to align content inside Shoulder_R and Elbow_R</div>
          </div>
        </div>
        <div class="pill" id="selName">Selected:</div>
      </div>

      <div class="body">
        <div class="fieldRow">
          <div class="field">
            <label>Shoulder identifier</label>
            <input id="shoulderId" type="text" value="Shoulder_R">
          </div>
          <div class="field">
            <label>Elbow identifier</label>
            <input id="elbowId" type="text" value="Elbow_R">
          </div>
        </div>

        <div class="btnRow">
          <button class="primary" id="btnArrange">Arrange</button>
          <button id="btnRefresh">Refresh selection</button>
          <button id="btnStore">Store for Pose Panel</button>
          <button id="btnZero">Zero Pose</button>
        </div>

        <div class="status" id="status">Ready</div>

        <div class="foot">
          <div class="hint">
            Arrange moves the content inside the clips so the pivot is at the top center
            then places Shoulder at the Arm pivot and Elbow at the end of the Shoulder content
            <div class="hintCode">Arm_R contains Shoulder_R contains Elbow_R</div>
          </div>
          <div class="brandMini" title="Luke Tools">
            <img alt="Luke Tools" src="https://raw.githubusercontent.com/lukeo25/WickTools/main/LukeToolsBrand.png">
            Luke Tools
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      "use strict";

      function s(v) { return (v === null || v === undefined) ? "" : String(v); }
      var NL = String.fromCharCode(10);

      function $(id) { return document.getElementById(id); }

      function getBridge() {
        try { if (window.LukeToolsBridge) return window.LukeToolsBridge; } catch (e1) {}
        try { if (parent && parent.LukeToolsBridge) return parent.LukeToolsBridge; } catch (e2) {}
        return null;
      }

      function setStatus(msg) {
        $("status").textContent = s(msg);
      }

      function refreshSelection() {
        var bridge = getBridge();
        if (!bridge) {
          $("selName").textContent = "Selected: bridge missing";
          setStatus("Bridge missing" + NL + "Update the Luke Tools userscript");
          return;
        }

        try {
          if (typeof bridge.captureSelectionNow === "function") bridge.captureSelectionNow();
        } catch (e1) {}

        var name = "";
        try {
          name = (typeof bridge.getSelectedClipName === "function") ? bridge.getSelectedClipName() : "";
        } catch (e2) {
          name = "";
        }

        $("selName").textContent = "Selected: " + (name ? name : "none");
      }

      function storeForPosePanel() {
        var sh = s($("shoulderId").value).trim() || "Shoulder_R";
        var el = s($("elbowId").value).trim() || "Elbow_R";
        try { localStorage.setItem("LukeToolsPoseShoulderIdentifier", sh); } catch (e1) {}
        try { localStorage.setItem("LukeToolsPoseElbowIdentifier", el); } catch (e2) {}
        setStatus("Stored identifiers for Pose Panel" + NL + "Shoulder " + sh + NL + "Elbow " + el);
      }

      function zeroPose() {
        try { localStorage.setItem("LukeToolsPoseShoulderDeg", "0"); } catch (e1) {}
        try { localStorage.setItem("LukeToolsPoseElbowDeg", "0"); } catch (e2) {}
        setStatus("Pose values set to 0");
      }

      function arrange() {
        var bridge = getBridge();
        if (!bridge) {
          setStatus("Bridge missing" + NL + "Update the Luke Tools userscript");
          return;
        }

        var sh = s($("shoulderId").value).trim() || "Shoulder_R";
        var el = s($("elbowId").value).trim() || "Elbow_R";

        storeForPosePanel();
        refreshSelection();

        if (typeof bridge.arrangeArmRigOnSelection !== "function") {
          setStatus("Arrange missing on bridge" + NL + "Update the Luke Tools userscript");
          return;
        }

        try {
          var res = bridge.arrangeArmRigOnSelection(sh, el);
          if (res && res.ok) {
            setStatus("Arrange ok" + NL + "Shoulder length " + s(res.shoulderLength));
          } else {
            setStatus("Arrange failed" + NL + s(res && res.error ? res.error : "unknown"));
          }
        } catch (e) {
          setStatus("Arrange error" + NL + s(e));
        }
      }

      $("btnArrange").addEventListener("click", arrange);
      $("btnRefresh").addEventListener("click", refreshSelection);
      $("btnStore").addEventListener("click", storeForPosePanel);
      $("btnZero").addEventListener("click", zeroPose);

      refreshSelection();
      setInterval(refreshSelection, 500);
    })();
  </script>
</body>
</html>
